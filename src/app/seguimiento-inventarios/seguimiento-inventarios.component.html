<div class="container mt-5">
    <div class="registro-movimientos-form card">
        <div class="card-header">
            <h5>Registrar Movimiento de Inventario</h5>
        </div>
        <div class="card-body">
            <form (ngSubmit)="registrarMovimiento()" #movimientoForm="ngForm">
                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label for="fecha">Fecha:</label>
                        <input type="date" id="fecha" name="fecha" class="form-control" [(ngModel)]="nuevoMovimiento.fecha" required>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="descripcion">Descripción:</label>
                        <input type="text" id="descripcion" name="descripcion" class="form-control" [(ngModel)]="nuevoMovimiento.descripcion" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label for="tipo">Tipo de Movimiento:</label>
                        <select id="tipo" name="tipo" class="form-control" [(ngModel)]="nuevoMovimiento.tipo" required>
                            <option value="Entrada">Entrada</option>
                            <option value="Salida">Salida</option>
                            <option value="Transferencia">Transferencia</option>
                        </select>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="cantidad">Cantidad:</label>
                        <input type="number" id="cantidad" name="cantidad" class="form-control" [(ngModel)]="nuevoMovimiento.cantidad" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="pieza">Pieza:</label>
                    <input type="text" id="pieza" name="pieza" class="form-control" [(ngModel)]="piezaBusqueda" (input)="buscarPiezas()" required>
                    <ul *ngIf="piezasFiltradas.length > 0" class="list-group">
                        <li *ngFor="let pieza of piezasFiltradas" class="list-group-item" (click)="seleccionarPieza(pieza)">
                            {{ pieza.nombre }}
                        </li>
                    </ul>
                </div>
                <button type="submit" class="btn btn-primary btn-block" [disabled]="!movimientoForm.valid">Registrar Movimiento</button>
            </form>
            <div class="mt-3 d-flex justify-content-between">
                <button class="btn btn-danger" (click)="exportarReporte('pdf')">Exportar PDF</button>
                <button class="btn btn-success" (click)="exportarReporte('xlsx')">Exportar Excel</button>
            </div>
        </div>
    </div>

    <div class="historial-movimientos mt-5">
        <h5>Historial de Movimientos</h5>
        <div class="table-responsive">
            <table class="table table-striped">
                <thead class="thead-dark">
                    <tr>
                        <th>Fecha</th>
                        <th>Descripción</th>
                        <th>Tipo de Movimiento</th>
                        <th>Cantidad</th>
                        <th>Pieza</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let movimiento of historialMovimientos">
                        <td>{{ movimiento.fecha | date: 'shortDate' }}</td>
                        <td>{{ movimiento.descripcion }}</td>
                        <td>{{ movimiento.tipo }}</td>
                        <td>{{ movimiento.cantidad }}</td>
                        <td>{{ movimiento.pieza?.nombre }}</td> <!-- Asegúrate de que 'pieza.nombre' esté disponible -->
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>